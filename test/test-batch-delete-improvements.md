# 批量删除功能改进测试

## 改进内容

### 1. 分组键支持
- 修复了分组键（如"bull"）不在预览列表中的问题
- 预览列表现在包含所有可见键和分组键

### 2. 移除功能
- 添加了复选框选择功能
- 支持排除特定键
- 提供全选/清空功能
- 实时显示选择统计

## 功能特性

### 1. 完整的键列表
- **可见键**：当前页面显示的键
- **分组键**：分组中的键（如"bull"）
- **搜索结果**：搜索匹配的键

### 2. 选择控制
- **复选框选择**：用户可以手动选择要删除的键
- **排除功能**：可以排除不想删除的键
- **全选/清空**：快速选择或清空所有键

### 3. 实时反馈
- **选择统计**：显示已选择的键数量
- **排除统计**：显示已排除的键数量
- **视觉反馈**：排除的键显示为半透明

## 测试步骤

### 1. 分组键显示测试
- [ ] 打开批量删除对话框
- [ ] 验证"bull"等分组键出现在预览列表中
- [ ] 验证所有可见键和分组键都包含在预览中
- [ ] 验证键数量统计正确

### 2. 选择功能测试
- [ ] 点击复选框选择单个键
- [ ] 点击"全选"按钮选择所有键
- [ ] 点击"清空"按钮取消所有选择
- [ ] 验证选择统计正确更新

### 3. 排除功能测试
- [ ] 点击键右侧的排除按钮
- [ ] 验证键变为半透明状态
- [ ] 验证复选框被禁用
- [ ] 验证排除统计正确更新
- [ ] 再次点击排除按钮取消排除

### 4. 删除确认测试
- [ ] 选择部分键进行删除
- [ ] 排除部分键
- [ ] 点击"确认删除"按钮
- [ ] 验证只有选中的键被删除
- [ ] 验证排除的键没有被删除

### 5. 用户体验测试
- [ ] 验证界面响应流畅
- [ ] 验证悬停效果正常
- [ ] 验证按钮状态正确
- 验证统计信息实时更新

## 技术实现

### 1. 键列表合并
```javascript
const previewKeys = computed(() => {
  // 合并所有键（可见键 + 分组键）
  const allKeys = [...props.visibleKeys, ...props.groupedKeys]
  
  switch (deleteForm.deleteMode) {
    case 'visible':
      return allKeys.slice(0, maxPreviewCount)
    // ...
  }
})
```

### 2. 选择状态管理
```javascript
const selectedKeys = ref([]) // 用户选择的要删除的键
const excludedKeys = ref([]) // 用户排除的键
```

### 3. 排除功能
```javascript
const toggleExcludeKey = (key) => {
  const index = excludedKeys.value.indexOf(key)
  if (index > -1) {
    // 取消排除
    excludedKeys.value.splice(index, 1)
    if (!selectedKeys.value.includes(key)) {
      selectedKeys.value.push(key)
    }
  } else {
    // 排除键
    excludedKeys.value.push(key)
    const selectedIndex = selectedKeys.value.indexOf(key)
    if (selectedIndex > -1) {
      selectedKeys.value.splice(selectedIndex, 1)
    }
  }
}
```

## 验证要点

### 1. 完整性
- [ ] 所有类型的键都包含在预览中
- [ ] 分组键正确显示
- [ ] 键数量统计准确

### 2. 选择功能
- [ ] 复选框正常工作
- [ ] 全选/清空功能正常
- [ ] 选择状态正确保存

### 3. 排除功能
- [ ] 排除按钮正常工作
- [ ] 排除状态正确显示
- [ ] 排除统计正确更新

### 4. 删除逻辑
- [ ] 只有选中的键被删除
- [ ] 排除的键不被删除
- [ ] 删除结果正确反馈

## 注意事项

1. **性能考虑**：大量键时使用虚拟滚动
2. **状态同步**：选择状态与排除状态同步
3. **用户体验**：提供清晰的视觉反馈
4. **数据一致性**：删除后及时更新键列表
5. **错误处理**：网络错误和权限错误正确处理

## 改进效果

### 修复前
- 分组键不在预览列表中
- 无法选择或排除特定键
- 只能删除所有预览的键

### 修复后
- 所有键都包含在预览中
- 支持灵活的选择和排除
- 提供精确的删除控制
- 更好的用户体验 