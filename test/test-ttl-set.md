# 设置TTL功能测试

## 功能概述
为Redis键设置过期时间（TTL）的功能已经开发完成。

## 功能特性
1. **多种时间单位支持**：秒、分钟、小时、天
2. **实时预览**：显示设置后的TTL格式
3. **表单验证**：确保TTL值为非负整数
4. **操作日志**：记录TTL设置操作
5. **统一消息管理**：通过API拦截器处理所有消息提示

## 测试步骤

### 1. 前端功能测试
- [ ] 选择一个永不过期的键（TTL = -1）
- [ ] 点击"设置"按钮打开TTL设置对话框
- [ ] 验证默认值：3600秒
- [ ] 测试不同时间单位：
  - 秒：输入60，预览显示"1分钟"
  - 分钟：输入30，预览显示"30分钟"
  - 小时：输入2，预览显示"2小时"
  - 天：输入1，预览显示"1天"
- [ ] 测试表单验证：
  - 输入负数：应该显示错误
  - 输入空值：应该显示错误
- [ ] 点击"确定"按钮设置TTL
- [ ] 验证成功后对话框关闭，TTL显示更新

### 2. 后端API测试
- [ ] 测试PUT `/api/connections/:id/:db/keys/:keyName/ttl`
- [ ] 验证参数验证：
  - 无效的TTL值（负数）
  - 无效的键名
  - 无权限访问连接
- [ ] 验证成功响应：`{ success: true, message: "TTL设置成功" }`

### 3. 集成测试
- [ ] 设置TTL后，验证键的TTL值正确更新
- [ ] 验证操作日志正确记录
- [ ] 验证消息提示正确显示（通过API拦截器）

## 技术实现

### 前端组件
- `KeyValueDisplay.vue`：集成了TTL设置对话框组件
- `SetTTLDialog.vue`：独立的TTL设置对话框组件
- `BaseDialog.vue`：基础对话框组件
- `FormDialog.vue`：表单对话框组件
- `connection.js`：添加了`setKeyTTL`方法
- `operationLogger.js`：添加了`logTTLSet`和`logTTLCleared`方法

### 后端服务
- `redis.js`：添加了`setKeyTTL`方法
- `keys.js`：添加了PUT `/api/connections/:id/:db/keys/:keyName/ttl`路由

### 关键特性
1. **模块化设计**：使用独立的对话框组件，遵循单一职责原则
2. **时间单位转换**：自动将用户输入的时间单位转换为秒
3. **实时预览**：使用`formatTTL`方法显示人性化的时间格式
4. **错误处理**：完整的参数验证和错误处理
5. **状态同步**：设置成功后立即更新前端显示
6. **组件复用**：基于BaseDialog和FormDialog构建，可复用性强

## 使用说明
1. 选择一个Redis键
2. 如果键的TTL为-1（永不过期），会显示"设置"按钮
3. 点击"设置"按钮打开对话框
4. 输入TTL值并选择时间单位
5. 查看预览确认设置正确
6. 点击"确定"完成设置

## 注意事项
- TTL值必须是非负整数
- 设置TTL会覆盖原有的过期时间
- 操作会记录在操作历史中
- 所有消息提示由API拦截器统一处理 