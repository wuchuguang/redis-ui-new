# 连接同步调试测试

## 问题描述

用户反馈："对不上"，可能指的是以下问题之一：
1. 数据库选择器显示的数据库数量与实际不符
2. 键列表显示的数据与选择的数据库不符
3. 搜索结果显示与实际数据不符
4. 组件状态与连接状态不同步

## 调试步骤

### 1. 检查控制台日志
- [ ] 打开浏览器开发者工具
- [ ] 查看Console标签页
- [ ] 连接Redis时观察日志输出
- [ ] 检查是否有错误信息

### 2. 验证数据库索引
- [ ] 确认Redis数据库索引范围：0-15（共16个）
- [ ] 验证循环条件：`for (let i = 0; i < 16; i++)`
- [ ] 验证数组长度：`Array.from({ length: 16 }, ...)`

### 3. 检查连接状态同步
- [ ] 连接Redis后检查props.connection是否正确
- [ ] 验证selectedDatabase是否正确重置为0
- [ ] 检查databases数组是否正确更新
- [ ] 验证keysData是否正确加载

### 4. 验证数据流
- [ ] 检查refreshDatabases方法是否正确执行
- [ ] 验证refreshKeys方法是否正确执行
- [ ] 检查API调用是否成功
- [ ] 验证数据更新是否正确

## 调试信息

### 1. 连接变化日志
```javascript
console.log('连接变化:', newConnection)
console.log('当前状态:', {
  selectedDatabase: selectedDatabase.value,
  databasesCount: databases.value.length,
  keysDataCount: keysData.value.length,
  connection: props.connection
})
```

### 2. 键数据更新日志
```javascript
console.log('键数据已更新:', {
  groupsCount: data.groups.length,
  totalKeys: data.totalKeys,
  selectedDatabase: selectedDatabase.value
})
```

### 3. 数据库列表更新日志
```javascript
console.log('数据库列表已更新:', dbList)
```

## 可能的问题和解决方案

### 1. 数据库索引不匹配
**问题**：循环条件或数组长度不正确
**解决**：确保使用 `i < 16` 和 `length: 16`

### 2. 状态不同步
**问题**：组件状态与连接状态不同步
**解决**：检查props.connection的传递和监听

### 3. 数据加载失败
**问题**：API调用失败或数据格式错误
**解决**：检查网络请求和错误处理

### 4. UI更新延迟
**问题**：数据更新但UI没有及时反映
**解决**：检查Vue的响应式更新机制

## 验证要点

### 1. 数据库选择器
- [ ] 显示16个数据库选项（DB0-DB15）
- [ ] 每个数据库显示正确的键数
- [ ] 选择数据库时正确切换

### 2. 键列表
- [ ] 显示当前选中数据库的键
- [ ] 分组显示正确
- [ ] 键数量统计正确

### 3. 搜索功能
- [ ] 搜索结果显示正确
- [ ] 搜索范围限制在当前数据库
- [ ] 搜索结果数量正确

### 4. 状态同步
- [ ] 连接状态与UI状态同步
- [ ] 数据库切换时数据正确更新
- [ ] 断开连接时状态正确清理

## 测试用例

### 测试用例1：基本连接
1. 创建Redis连接
2. 观察控制台日志
3. 验证数据库选择器显示
4. 验证键列表加载

### 测试用例2：数据库切换
1. 选择不同的数据库
2. 观察键列表更新
3. 验证数据一致性

### 测试用例3：搜索功能
1. 在搜索框输入关键词
2. 观察搜索结果
3. 验证结果准确性

### 测试用例4：断开连接
1. 断开Redis连接
2. 观察状态清理
3. 验证UI禁用状态

## 预期结果

### 正常情况
- 控制台显示正确的调试信息
- 数据库选择器显示16个选项
- 键列表正确显示当前数据库的键
- 搜索功能正常工作
- 状态同步正确

### 异常情况
- 控制台显示错误信息
- 数据库选择器显示异常
- 键列表显示错误数据
- 搜索功能异常
- 状态不同步

## 下一步行动

根据调试结果，确定具体问题并采取相应的修复措施：

1. **如果是数据库索引问题**：修复循环条件和数组长度
2. **如果是状态同步问题**：检查props传递和监听逻辑
3. **如果是数据加载问题**：检查API调用和错误处理
4. **如果是UI更新问题**：检查Vue响应式机制

## 注意事项

1. **日志级别**：确保调试日志不会影响生产环境
2. **错误处理**：提供友好的错误提示
3. **性能考虑**：避免过多的调试日志影响性能
4. **用户体验**：确保调试不影响正常使用 