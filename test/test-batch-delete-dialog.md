# 批量删除对话框功能测试

## 功能概述
创建独立的批量删除对话框组件，解决预览逻辑问题，提供完整的批量删除功能。

## 问题分析

### 1. 组件化问题
- 批量删除功能应该用独立的对话框组件
- 遵循模块化设计原则

### 2. 预览逻辑问题
- "bull"键没有在预览列表中显示
- 预览逻辑需要修复

## 功能特性

### 1. 删除模式
- **可见键删除**：删除所有可见的键
- **搜索结果删除**：仅删除搜索结果中的键
- **自定义模式**：支持通配符模式删除

### 2. 预览功能
- 实时预览将被删除的键
- 显示键数量统计
- 支持滚动查看大量键

### 3. 安全确认
- 危险操作警告
- 二次确认机制
- 详细的操作说明

## 测试步骤

### 1. 基本功能测试
- [ ] 点击批量删除按钮打开对话框
- [ ] 验证对话框正确显示
- [ ] 验证警告信息正确显示
- [ ] 验证删除选项正确显示

### 2. 预览功能测试
- [ ] 选择"删除所有可见的键"模式
- [ ] 验证预览列表包含所有可见键（包括"bull"）
- [ ] 验证键数量统计正确
- [ ] 验证预览列表可滚动

### 3. 删除模式测试
- [ ] 测试"删除所有可见的键"模式
- [ ] 测试"仅删除搜索结果中的键"模式
- [ ] 测试"自定义删除模式"
- [ ] 验证模式切换时预览正确更新

### 4. 自定义模式测试
- [ ] 输入通配符模式（如"user:*"）
- [ ] 验证预览列表正确过滤
- [ ] 验证模式帮助信息正确显示

### 5. 确认删除测试
- [ ] 点击"确认删除"按钮
- [ ] 验证删除操作成功执行
- [ ] 验证操作日志正确记录
- [ ] 验证对话框正确关闭

## 技术实现

### 1. 组件架构
```
BatchDeleteDialog.vue
├── FormDialog.vue (基础表单对话框)
    └── BaseDialog.vue (基础对话框)
```

### 2. 预览逻辑修复
```javascript
const previewKeys = computed(() => {
  switch (deleteForm.deleteMode) {
    case 'visible':
      return props.visibleKeys.slice(0, maxPreviewCount)
    case 'search':
      return props.searchResults.slice(0, maxPreviewCount)
    case 'custom':
      return props.visibleKeys.filter(key => 
        key.includes(deleteForm.customPattern.replace('*', ''))
      ).slice(0, maxPreviewCount)
    default:
      return []
  }
})
```

### 3. API接口
```
DELETE /api/connections/:id/:db/keys/batch
```

## 验证要点

### 1. 预览逻辑
- [ ] "bull"键正确显示在预览列表中
- [ ] 所有可见键都包含在预览中
- [ ] 预览数量与实际删除数量一致

### 2. 用户体验
- [ ] 对话框响应迅速
- [ ] 预览列表滚动流畅
- [ ] 操作确认清晰明确

### 3. 安全性
- [ ] 危险操作有明确警告
- [ ] 二次确认机制有效
- [ ] 操作日志完整记录

## 注意事项

1. **预览数量限制**：最多显示50个键，避免界面卡顿
2. **通配符支持**：支持*和?通配符
3. **错误处理**：网络错误和权限错误正确处理
4. **性能优化**：大量键时使用虚拟滚动
5. **数据一致性**：删除后及时更新键列表

## 修复内容

### 1. 预览逻辑修复
- 确保所有可见键都包含在预览中
- 修复"bull"键不显示的问题
- 优化预览性能

### 2. 组件化重构
- 创建独立的BatchDeleteDialog组件
- 基于FormDialog构建
- 遵循模块化设计原则

### 3. 功能完善
- 支持多种删除模式
- 实时预览功能
- 完整的错误处理 